
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rete.js with React in Vanilla JS</title>
    <!-- Import React, ReactDOM, and Babel from CDN -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-is/18.2.0/umd/react-is.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/styled-components@5.3.6/dist/styled-components.min.js"></script>
    <script src="https://unpkg.com/elkjs@0.8.2/lib/elk.bundled.js"></script>

    <!-- Import Rete.js and its plugins from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/rete@2.0.3/rete.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-area-plugin@2.0.3/rete-area-plugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-connection-plugin@2.0.2/rete-connection-plugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-render-utils@2.0.2/rete-render-utils.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-react-plugin@2.0.5/rete-react-plugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-auto-arrange-plugin@2.0.1/rete-auto-arrange-plugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-minimap-plugin@2.0.1/rete-minimap-plugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-scopes-plugin@2.1.0/rete-scopes-plugin.min.js"></script>

    <style>
        .App {
            font-family: sans-serif;
            background: rgb(200, 190, 190);
        }
        .rete {
          position: relative;
          font-size: 1rem;
          margin: 1em;
          border-radius: 1em;
          text-align: left;
        }
        #fullscreen-btn {
            margin-left: 10px;
        }
        body {
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">

        const { useState, useRef, useEffect } = React;
        const { createRoot } = ReactDOM;
        const { NodeEditor, ClassicPreset } = Rete;
        const { AreaPlugin, AreaExtensions } = ReteAreaPlugin;
        const { ScopesPlugin, Presets: ScopesPresets } = ReteScopesPlugin;
        const { ConnectionPlugin, Presets: ConnectionPresets } = ReteConnectionPlugin;
        const { ReactPlugin, Presets } = ReteReactPlugin;
        const { AutoArrangePlugin, Presets: ArrangePresets, ArrangeAppliers} = ReteAutoArrangePlugin;
        const { MinimapExtra, MinimapPlugin } = ReteMinimapPlugin;
        const { RenderUtils } = ReteRenderUtils;
        const styled = window.styled;

        const nodegraphData = {"name": "Ag3PO4_Complete_Workflow", "uuid": "f1ffd4d0-a698-11f0-9278-3c7c3f7b47f5", "state": "CREATED", "nodes": {"graph_inputs": {"identifier": "graph_inputs", "label": "graph_inputs", "node_type": "NORMAL", "inputs": [], "properties": {"structures_dir": {"identifier": "workgraph.string", "value": "/home/thiagotd/git/worktree/PS-TEROS/feature-relax-energy/examples/complete/structures"}, "bulk_name": {"identifier": "workgraph.string", "value": "ag3po4.cif"}, "code_label": {"identifier": "workgraph.string", "value": "VASP-VTST-6.4.3@bohr"}, "potential_family": {"identifier": "workgraph.string", "value": "PBE"}, "bulk_potential_mapping": {"identifier": "workgraph.dict", "value": null}, "kpoints_spacing": {"identifier": "workgraph.float", "value": 0.3}, "bulk_parameters": {"identifier": "workgraph.dict", "value": null}, "bulk_options": {"identifier": "workgraph.dict", "value": null}, "clean_workdir": {"identifier": "workgraph.bool", "value": true}, "metal_name": {"identifier": "workgraph.string", "value": "Ag.cif"}, "oxygen_name": {"identifier": "workgraph.string", "value": "O2.cif"}, "metal_potential_mapping": {"identifier": "workgraph.dict", "value": null}, "metal_parameters": {"identifier": "workgraph.dict", "value": null}, "metal_options": {"identifier": "workgraph.dict", "value": null}, "oxygen_potential_mapping": {"identifier": "workgraph.dict", "value": null}, "oxygen_parameters": {"identifier": "workgraph.dict", "value": null}, "oxygen_options": {"identifier": "workgraph.dict", "value": null}, "nonmetal_name": {"identifier": "workgraph.string", "value": "P.cif"}, "nonmetal_potential_mapping": {"identifier": "workgraph.dict", "value": null}, "nonmetal_parameters": {"identifier": "workgraph.dict", "value": null}, "nonmetal_options": {"identifier": "workgraph.dict", "value": null}, "miller_indices": {"identifier": "workgraph.list", "value": null}, "min_slab_thickness": {"identifier": "workgraph.float", "value": 15.0}, "min_vacuum_thickness": {"identifier": "workgraph.float", "value": 15.0}, "slab_parameters": {"identifier": "workgraph.dict", "value": null}, "slab_options": {"identifier": "workgraph.dict", "value": null}, "slab_potential_mapping": {"identifier": "workgraph.dict", "value": null}, "slab_kpoints_spacing": {"identifier": "workgraph.float", "value": null}, "lll_reduce": {"identifier": "workgraph.bool", "value": false}, "center_slab": {"identifier": "workgraph.bool", "value": true}, "symmetrize": {"identifier": "workgraph.bool", "value": false}, "primitive": {"identifier": "workgraph.bool", "value": true}, "in_unit_planes": {"identifier": "workgraph.bool", "value": false}, "max_normal_search": {"identifier": "workgraph.int", "value": null}, "relax_slabs": {"identifier": "workgraph.bool", "value": true}, "compute_thermodynamics": {"identifier": "workgraph.bool", "value": true}, "thermodynamics_sampling": {"identifier": "workgraph.int", "value": 50}, "compute_relaxation_energy": {"identifier": "workgraph.bool", "value": true}, "input_slabs": {"identifier": "workgraph.dict", "value": null}, "use_input_slabs": {"identifier": "workgraph.bool", "value": false}, "compute_cleavage": {"identifier": "workgraph.bool", "value": true}}, "outputs": [{"name": "bulk_options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "bulk_potential_mapping"}, {"name": "clean_workdir"}, {"name": "metal_options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "metal_potential_mapping"}, {"name": "clean_workdir"}, {"name": "nonmetal_options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "nonmetal_potential_mapping"}, {"name": "clean_workdir"}, {"name": "oxygen_options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "oxygen_potential_mapping"}, {"name": "clean_workdir"}, {"name": "potential_family"}, {"name": "bulk_potential_mapping"}, {"name": "slab_parameters"}, {"name": "slab_options"}, {"name": "kpoints_spacing"}, {"name": "clean_workdir"}, {"name": "potential_family"}, {"name": "bulk_potential_mapping"}, {"name": "slab_parameters"}, {"name": "slab_options"}, {"name": "kpoints_spacing"}, {"name": "clean_workdir"}, {"name": "thermodynamics_sampling"}], "position": [30, 30], "children": []}, "graph_outputs": {"identifier": "graph_outputs", "label": "graph_outputs", "node_type": "NORMAL", "inputs": [{"name": "bulk_energy", "identifier": "workgraph.any"}, {"name": "metal_energy", "identifier": "workgraph.any"}, {"name": "nonmetal_energy", "identifier": "workgraph.any"}, {"name": "oxygen_energy", "identifier": "workgraph.any"}, {"name": "bulk_structure", "identifier": "workgraph.any"}, {"name": "metal_structure", "identifier": "workgraph.any"}, {"name": "nonmetal_structure", "identifier": "workgraph.any"}, {"name": "oxygen_structure", "identifier": "workgraph.any"}, {"name": "formation_enthalpy", "identifier": "workgraph.any"}, {"name": "slab_structures", "identifier": "workgraph.any"}, {"name": "relaxed_slabs", "identifier": "workgraph.any"}, {"name": "slab_energies", "identifier": "workgraph.any"}, {"name": "unrelaxed_slab_energies", "identifier": "workgraph.any"}, {"name": "relaxation_energies", "identifier": "workgraph.any"}, {"name": "surface_energies", "identifier": "workgraph.any"}, {"name": "cleavage_energies", "identifier": "workgraph.any"}, {"name": "slab_remote", "identifier": "workgraph.any"}, {"name": "unrelaxed_slab_remote", "identifier": "workgraph.any"}, {"name": "bulk_energy"}, {"name": "bulk_structure"}, {"name": "metal_energy"}, {"name": "metal_structure"}, {"name": "nonmetal_energy"}, {"name": "nonmetal_structure"}, {"name": "oxygen_energy"}, {"name": "oxygen_structure"}, {"name": "formation_enthalpy"}, {"name": "slab_structures"}, {"name": "relaxed_slabs"}, {"name": "slab_energies"}, {"name": "unrelaxed_slab_energies"}, {"name": "relaxation_energies"}, {"name": "surface_energies"}, {"name": "cleavage_energies"}, {"name": "slab_remote"}, {"name": "unrelaxed_slab_remote"}], "properties": {"bulk_energy": {"identifier": "workgraph.any", "value": null}, "metal_energy": {"identifier": "workgraph.any", "value": null}, "nonmetal_energy": {"identifier": "workgraph.any", "value": null}, "oxygen_energy": {"identifier": "workgraph.any", "value": null}, "bulk_structure": {"identifier": "workgraph.any", "value": null}, "metal_structure": {"identifier": "workgraph.any", "value": null}, "nonmetal_structure": {"identifier": "workgraph.any", "value": null}, "oxygen_structure": {"identifier": "workgraph.any", "value": null}, "formation_enthalpy": {"identifier": "workgraph.any", "value": null}, "slab_structures": {"identifier": "workgraph.any", "value": null}, "relaxed_slabs": {"identifier": "workgraph.any", "value": null}, "slab_energies": {"identifier": "workgraph.any", "value": null}, "unrelaxed_slab_energies": {"identifier": "workgraph.any", "value": null}, "relaxation_energies": {"identifier": "workgraph.any", "value": null}, "surface_energies": {"identifier": "workgraph.any", "value": null}, "cleavage_energies": {"identifier": "workgraph.any", "value": null}, "slab_remote": {"identifier": "workgraph.any", "value": null}, "unrelaxed_slab_remote": {"identifier": "workgraph.any", "value": null}}, "outputs": [], "position": [30, 30], "children": []}, "VaspWorkChain": {"identifier": "VaspWorkChain", "label": "VaspWorkChain", "node_type": "WORKCHAIN", "inputs": [{"name": "code", "identifier": "workgraph.any"}, {"name": "structure", "identifier": "workgraph.any"}, {"name": "potential_family", "identifier": "workgraph.string"}, {"name": "potential_mapping", "identifier": "workgraph.dict"}, {"name": "parameters", "identifier": "workgraph.dict"}, {"name": "options", "identifier": "workgraph.dict"}, {"name": "dynamics", "identifier": "workgraph.namespace"}, {"name": "options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "potential_mapping"}, {"name": "clean_workdir"}], "properties": {"max_iterations": {"identifier": "workgraph.any", "value": null}, "clean_workdir": {"identifier": "workgraph.any", "value": null}, "handler_overrides": {"identifier": "workgraph.any", "value": null}, "code": {"identifier": "workgraph.any", "value": {"with_mpi": null, "append_text": "", "input_plugin": "vasp.vasp", "prepend_text": "module load intel/oneAPI/2022\nexport I_MPI_HYDRA_BOOTSTRAP=rsh\nexport I_MPI_HYDRA_BOOTSTRAP_EXEC=/opt/pbs/bin/pbs_tmrsh\nexport I_MPI_DEVICE=rdssm\nexport I_MPI_FABRICS=ofa\n", "use_double_quotes": false, "filepath_executable": "/home/des01/zacarias/dorinitt/binVTST/vasp_std", "wrap_cmdline_params": false, "node_type": "data.core.code.installed.InstalledCode."}}, "structure": {"identifier": "workgraph.any", "value": {"cell": [[6.1199103344264, 0.0, 0.0], [0.0, 6.1199103338843, 0.0], [0.0, 0.0, 6.1199103321121]], "pbc1": true, "pbc2": true, "pbc3": true, "kinds": [{"symbols": ["Ag"], "weights": [1.0], "mass": 107.8682, "name": "Ag"}, {"symbols": ["P"], "weights": [1.0], "mass": 30.973761998, "name": "P"}, {"symbols": ["O"], "weights": [1.0], "mass": 15.999, "name": "O"}], "sites": [{"position": [6.119910331236191, 3.059955163011, 1.5295109083471], "kind_name": "Ag"}, {"position": [8.0657114436085e-09, 3.0599551698475, 4.590399423164101], "kind_name": "Ag"}, {"position": [4.5903994230016, 1.7353657899637002e-10, 3.0599551579884006], "kind_name": "Ag"}, {"position": [3.0599551653591996, 1.529510905287, 9.022839614069402e-09], "kind_name": "Ag"}, {"position": [1.5295109183033, 2.2849327659775e-10, 3.0599551755387004], "kind_name": "Ag"}, {"position": [3.0599551670817995, 4.590399420702401, 6.1199103220785185], "kind_name": "Ag"}, {"position": [3.0599551610881, 3.0599551707256003, 3.0599551632448], "kind_name": "P"}, {"position": [6.119910330043415, 1.4677413273831002e-08, 1.8227561018075e-09], "kind_name": "P"}, {"position": [5.2147432247637, 5.214743225462901, 5.2147432280469], "kind_name": "O"}, {"position": [3.9704583254989, 2.1494520033671, 3.9704583229102006], "kind_name": "O"}, {"position": [2.1494520167986, 3.9704583230963006, 3.9704583197840004], "kind_name": "O"}, {"position": [3.9704583373066997, 3.9704583335551, 2.1494520107752], "kind_name": "O"}, {"position": [2.1494520135601, 2.1494520224249003, 2.1494520044771], "kind_name": "O"}, {"position": [0.9051671030058799, 0.90516710194047, 5.214743225768301], "kind_name": "O"}, {"position": [0.9051671049136198, 5.2147432243506, 0.90516710673636], "kind_name": "O"}, {"position": [5.2147432285388, 0.90516710731153, 0.9051671073027501], "kind_name": "O"}], "node_type": "data.core.structure.StructureData."}}, "kpoints": {"identifier": "workgraph.any", "value": null}, "potential_family": {"identifier": "workgraph.string", "value": null}, "potential_mapping": {"identifier": "workgraph.dict", "value": null}, "parameters": {"identifier": "workgraph.dict", "value": null}, "options": {"identifier": "workgraph.dict", "value": null}, "settings": {"identifier": "workgraph.any", "value": {"parser_settings": {"add_energy": true, "add_trajectory": true, "add_structure": true, "add_kpoints": true}, "node_type": "data.core.dict.Dict."}}, "wavecar": {"identifier": "workgraph.any", "value": null}, "chgcar": {"identifier": "workgraph.any", "value": null}, "site_magnetization": {"identifier": "workgraph.any", "value": null}, "restart_folder": {"identifier": "workgraph.any", "value": null}, "keep_last_workdir": {"identifier": "workgraph.bool", "value": null}, "verbose": {"identifier": "workgraph.any", "value": null}, "ldau_mapping": {"identifier": "workgraph.any", "value": null}, "kpoints_spacing": {"identifier": "workgraph.any", "value": null}, "auto_parallel": {"identifier": "workgraph.any", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "misc"}, {"name": "structure"}, {"name": "structure"}, {"name": "structure"}, {"name": "structure"}, {"name": "structure"}, {"name": "structure"}], "position": [30, 30], "children": []}, "extract_total_energy": {"identifier": "extract_total_energy", "label": "extract_total_energy", "node_type": "CALCFUNCTION", "inputs": [{"name": "energies", "identifier": "workgraph.dict"}, {"name": "energies"}], "properties": {"energies": {"identifier": "workgraph.dict", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "result"}, {"name": "result"}, {"name": "result"}, {"name": "result"}], "position": [30, 30], "children": []}, "VaspWorkChain1": {"identifier": "VaspWorkChain", "label": "VaspWorkChain1", "node_type": "WORKCHAIN", "inputs": [{"name": "code", "identifier": "workgraph.any"}, {"name": "structure", "identifier": "workgraph.any"}, {"name": "potential_family", "identifier": "workgraph.string"}, {"name": "potential_mapping", "identifier": "workgraph.dict"}, {"name": "parameters", "identifier": "workgraph.dict"}, {"name": "options", "identifier": "workgraph.dict"}, {"name": "dynamics", "identifier": "workgraph.namespace"}, {"name": "options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "potential_mapping"}, {"name": "clean_workdir"}], "properties": {"max_iterations": {"identifier": "workgraph.any", "value": null}, "clean_workdir": {"identifier": "workgraph.any", "value": null}, "handler_overrides": {"identifier": "workgraph.any", "value": null}, "code": {"identifier": "workgraph.any", "value": {"with_mpi": null, "append_text": "", "input_plugin": "vasp.vasp", "prepend_text": "module load intel/oneAPI/2022\nexport I_MPI_HYDRA_BOOTSTRAP=rsh\nexport I_MPI_HYDRA_BOOTSTRAP_EXEC=/opt/pbs/bin/pbs_tmrsh\nexport I_MPI_DEVICE=rdssm\nexport I_MPI_FABRICS=ofa\n", "use_double_quotes": false, "filepath_executable": "/home/des01/zacarias/dorinitt/binVTST/vasp_std", "wrap_cmdline_params": false, "node_type": "data.core.code.installed.InstalledCode."}}, "structure": {"identifier": "workgraph.any", "value": {"cell": [[4.10435636, 0.0, 0.0], [0.0, 4.10435636, 0.0], [0.0, 0.0, 4.10435636]], "pbc1": true, "pbc2": true, "pbc3": true, "kinds": [{"symbols": ["Ag"], "weights": [1.0], "mass": 107.8682, "name": "Ag"}], "sites": [{"position": [0.0, 0.0, 0.0], "kind_name": "Ag"}, {"position": [0.0, 2.05217818, 2.05217818], "kind_name": "Ag"}, {"position": [2.05217818, 0.0, 2.05217818], "kind_name": "Ag"}, {"position": [2.05217818, 2.05217818, 0.0], "kind_name": "Ag"}], "node_type": "data.core.structure.StructureData."}}, "kpoints": {"identifier": "workgraph.any", "value": null}, "potential_family": {"identifier": "workgraph.string", "value": null}, "potential_mapping": {"identifier": "workgraph.dict", "value": null}, "parameters": {"identifier": "workgraph.dict", "value": null}, "options": {"identifier": "workgraph.dict", "value": null}, "settings": {"identifier": "workgraph.any", "value": {"parser_settings": {"add_energy": true, "add_trajectory": true, "add_structure": true, "add_kpoints": true}, "node_type": "data.core.dict.Dict."}}, "wavecar": {"identifier": "workgraph.any", "value": null}, "chgcar": {"identifier": "workgraph.any", "value": null}, "site_magnetization": {"identifier": "workgraph.any", "value": null}, "restart_folder": {"identifier": "workgraph.any", "value": null}, "keep_last_workdir": {"identifier": "workgraph.bool", "value": null}, "verbose": {"identifier": "workgraph.any", "value": null}, "ldau_mapping": {"identifier": "workgraph.any", "value": null}, "kpoints_spacing": {"identifier": "workgraph.any", "value": null}, "auto_parallel": {"identifier": "workgraph.any", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "misc"}, {"name": "structure"}, {"name": "structure"}], "position": [30, 30], "children": []}, "extract_total_energy1": {"identifier": "extract_total_energy", "label": "extract_total_energy1", "node_type": "CALCFUNCTION", "inputs": [{"name": "energies", "identifier": "workgraph.dict"}, {"name": "energies"}], "properties": {"energies": {"identifier": "workgraph.dict", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "result"}, {"name": "result"}], "position": [30, 30], "children": []}, "VaspWorkChain2": {"identifier": "VaspWorkChain", "label": "VaspWorkChain2", "node_type": "WORKCHAIN", "inputs": [{"name": "code", "identifier": "workgraph.any"}, {"name": "structure", "identifier": "workgraph.any"}, {"name": "potential_family", "identifier": "workgraph.string"}, {"name": "potential_mapping", "identifier": "workgraph.dict"}, {"name": "parameters", "identifier": "workgraph.dict"}, {"name": "options", "identifier": "workgraph.dict"}, {"name": "dynamics", "identifier": "workgraph.namespace"}, {"name": "options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "potential_mapping"}, {"name": "clean_workdir"}], "properties": {"max_iterations": {"identifier": "workgraph.any", "value": null}, "clean_workdir": {"identifier": "workgraph.any", "value": null}, "handler_overrides": {"identifier": "workgraph.any", "value": null}, "code": {"identifier": "workgraph.any", "value": {"with_mpi": null, "append_text": "", "input_plugin": "vasp.vasp", "prepend_text": "module load intel/oneAPI/2022\nexport I_MPI_HYDRA_BOOTSTRAP=rsh\nexport I_MPI_HYDRA_BOOTSTRAP_EXEC=/opt/pbs/bin/pbs_tmrsh\nexport I_MPI_DEVICE=rdssm\nexport I_MPI_FABRICS=ofa\n", "use_double_quotes": false, "filepath_executable": "/home/des01/zacarias/dorinitt/binVTST/vasp_std", "wrap_cmdline_params": false, "node_type": "data.core.code.installed.InstalledCode."}}, "structure": {"identifier": "workgraph.any", "value": {"cell": [[2.42469411, 0.0, 0.0], [0.0, 2.43853514, 0.0], [0.0, 0.0, 4.85247542]], "pbc1": true, "pbc2": true, "pbc3": true, "kinds": [{"symbols": ["P"], "weights": [1.0], "mass": 30.973761998, "name": "P"}], "sites": [{"position": [0.0, 0.0, 3.6365681385246518], "kind_name": "P"}, {"position": [0.0, 0.0, 1.2159072814753489], "kind_name": "P"}], "node_type": "data.core.structure.StructureData."}}, "kpoints": {"identifier": "workgraph.any", "value": null}, "potential_family": {"identifier": "workgraph.string", "value": null}, "potential_mapping": {"identifier": "workgraph.dict", "value": null}, "parameters": {"identifier": "workgraph.dict", "value": null}, "options": {"identifier": "workgraph.dict", "value": null}, "settings": {"identifier": "workgraph.any", "value": {"parser_settings": {"add_energy": true, "add_trajectory": true, "add_structure": true, "add_kpoints": true}, "node_type": "data.core.dict.Dict."}}, "wavecar": {"identifier": "workgraph.any", "value": null}, "chgcar": {"identifier": "workgraph.any", "value": null}, "site_magnetization": {"identifier": "workgraph.any", "value": null}, "restart_folder": {"identifier": "workgraph.any", "value": null}, "keep_last_workdir": {"identifier": "workgraph.bool", "value": null}, "verbose": {"identifier": "workgraph.any", "value": null}, "ldau_mapping": {"identifier": "workgraph.any", "value": null}, "kpoints_spacing": {"identifier": "workgraph.any", "value": null}, "auto_parallel": {"identifier": "workgraph.any", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "misc"}, {"name": "structure"}, {"name": "structure"}], "position": [30, 30], "children": []}, "extract_total_energy2": {"identifier": "extract_total_energy", "label": "extract_total_energy2", "node_type": "CALCFUNCTION", "inputs": [{"name": "energies", "identifier": "workgraph.dict"}, {"name": "energies"}], "properties": {"energies": {"identifier": "workgraph.dict", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "result"}, {"name": "result"}], "position": [30, 30], "children": []}, "VaspWorkChain3": {"identifier": "VaspWorkChain", "label": "VaspWorkChain3", "node_type": "WORKCHAIN", "inputs": [{"name": "code", "identifier": "workgraph.any"}, {"name": "structure", "identifier": "workgraph.any"}, {"name": "potential_family", "identifier": "workgraph.string"}, {"name": "potential_mapping", "identifier": "workgraph.dict"}, {"name": "parameters", "identifier": "workgraph.dict"}, {"name": "options", "identifier": "workgraph.dict"}, {"name": "dynamics", "identifier": "workgraph.namespace"}, {"name": "options"}, {"name": "kpoints_spacing"}, {"name": "potential_family"}, {"name": "potential_mapping"}, {"name": "clean_workdir"}], "properties": {"max_iterations": {"identifier": "workgraph.any", "value": null}, "clean_workdir": {"identifier": "workgraph.any", "value": null}, "handler_overrides": {"identifier": "workgraph.any", "value": null}, "code": {"identifier": "workgraph.any", "value": {"with_mpi": null, "append_text": "", "input_plugin": "vasp.vasp", "prepend_text": "module load intel/oneAPI/2022\nexport I_MPI_HYDRA_BOOTSTRAP=rsh\nexport I_MPI_HYDRA_BOOTSTRAP_EXEC=/opt/pbs/bin/pbs_tmrsh\nexport I_MPI_DEVICE=rdssm\nexport I_MPI_FABRICS=ofa\n", "use_double_quotes": false, "filepath_executable": "/home/des01/zacarias/dorinitt/binVTST/vasp_std", "wrap_cmdline_params": false, "node_type": "data.core.code.installed.InstalledCode."}}, "structure": {"identifier": "workgraph.any", "value": {"cell": [[15.0, 0.0, 0.0], [0.0, 15.0, 0.0], [0.0, 0.0, 15.0]], "pbc1": true, "pbc2": true, "pbc3": true, "kinds": [{"symbols": ["O"], "weights": [1.0], "mass": 15.999, "name": "O"}], "sites": [{"position": [7.5, 7.5, 8.745956], "kind_name": "O"}, {"position": [7.5, 7.5, 7.5], "kind_name": "O"}], "node_type": "data.core.structure.StructureData."}}, "kpoints": {"identifier": "workgraph.any", "value": null}, "potential_family": {"identifier": "workgraph.string", "value": null}, "potential_mapping": {"identifier": "workgraph.dict", "value": null}, "parameters": {"identifier": "workgraph.dict", "value": null}, "options": {"identifier": "workgraph.dict", "value": null}, "settings": {"identifier": "workgraph.any", "value": {"parser_settings": {"add_energy": true, "add_trajectory": true, "add_structure": true, "add_kpoints": true}, "node_type": "data.core.dict.Dict."}}, "wavecar": {"identifier": "workgraph.any", "value": null}, "chgcar": {"identifier": "workgraph.any", "value": null}, "site_magnetization": {"identifier": "workgraph.any", "value": null}, "restart_folder": {"identifier": "workgraph.any", "value": null}, "keep_last_workdir": {"identifier": "workgraph.bool", "value": null}, "verbose": {"identifier": "workgraph.any", "value": null}, "ldau_mapping": {"identifier": "workgraph.any", "value": null}, "kpoints_spacing": {"identifier": "workgraph.any", "value": null}, "auto_parallel": {"identifier": "workgraph.any", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "misc"}, {"name": "structure"}, {"name": "structure"}], "position": [30, 30], "children": []}, "extract_total_energy3": {"identifier": "extract_total_energy", "label": "extract_total_energy3", "node_type": "CALCFUNCTION", "inputs": [{"name": "energies", "identifier": "workgraph.dict"}, {"name": "energies"}], "properties": {"energies": {"identifier": "workgraph.dict", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "result"}, {"name": "result"}], "position": [30, 30], "children": []}, "calculate_formation_enthalpy": {"identifier": "calculate_formation_enthalpy", "label": "calculate_formation_enthalpy", "node_type": "CALCFUNCTION", "inputs": [{"name": "bulk_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "bulk_energy", "identifier": "workgraph.float"}, {"name": "metal_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "metal_energy", "identifier": "workgraph.float"}, {"name": "nonmetal_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "nonmetal_energy", "identifier": "workgraph.float"}, {"name": "oxygen_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "oxygen_energy", "identifier": "workgraph.float"}, {"name": "bulk_structure"}, {"name": "bulk_energy"}, {"name": "metal_structure"}, {"name": "metal_energy"}, {"name": "nonmetal_structure"}, {"name": "nonmetal_energy"}, {"name": "oxygen_structure"}, {"name": "oxygen_energy"}], "properties": {"bulk_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "bulk_energy": {"identifier": "workgraph.float", "value": null}, "metal_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "metal_energy": {"identifier": "workgraph.float", "value": null}, "nonmetal_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "nonmetal_energy": {"identifier": "workgraph.float", "value": null}, "oxygen_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "oxygen_energy": {"identifier": "workgraph.float", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "result"}, {"name": "result"}, {"name": "result"}], "position": [30, 30], "children": []}, "generate_slab_structures": {"identifier": "generate_slab_structures", "label": "generate_slab_structures", "node_type": "CALCFUNCTION", "inputs": [{"name": "bulk_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "miller_indices", "identifier": "workgraph.list"}, {"name": "min_slab_thickness", "identifier": "workgraph.float"}, {"name": "min_vacuum_thickness", "identifier": "workgraph.float"}, {"name": "lll_reduce", "identifier": "workgraph.bool"}, {"name": "center_slab", "identifier": "workgraph.bool"}, {"name": "symmetrize", "identifier": "workgraph.bool"}, {"name": "primitive", "identifier": "workgraph.bool"}, {"name": "bulk_structure"}], "properties": {"bulk_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "miller_indices": {"identifier": "workgraph.list", "value": {"list": [1, 0, 0], "node_type": "data.core.list.List."}}, "min_slab_thickness": {"identifier": "workgraph.float", "value": 15.0}, "min_vacuum_thickness": {"identifier": "workgraph.float", "value": 15.0}, "lll_reduce": {"identifier": "workgraph.bool", "value": false}, "center_slab": {"identifier": "workgraph.bool", "value": true}, "symmetrize": {"identifier": "workgraph.bool", "value": false}, "primitive": {"identifier": "workgraph.bool", "value": true}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "slabs"}, {"name": "slabs"}, {"name": "slabs"}], "position": [30, 30], "children": []}, "scf_slabs_scatter": {"identifier": "scf_slabs_scatter", "label": "scf_slabs_scatter", "node_type": "GRAPH", "inputs": [{"name": "slabs", "identifier": "workgraph.namespace"}, {"name": "code", "identifier": "workgraph.any"}, {"name": "potential_family", "identifier": "workgraph.string"}, {"name": "potential_mapping", "identifier": "workgraph.any"}, {"name": "parameters", "identifier": "workgraph.any"}, {"name": "options", "identifier": "workgraph.any"}, {"name": "slabs"}, {"name": "potential_family"}, {"name": "potential_mapping"}, {"name": "parameters"}, {"name": "options"}, {"name": "kpoints_spacing"}, {"name": "clean_workdir"}], "properties": {"code": {"identifier": "workgraph.any", "value": {"with_mpi": null, "append_text": "", "input_plugin": "vasp.vasp", "prepend_text": "module load intel/oneAPI/2022\nexport I_MPI_HYDRA_BOOTSTRAP=rsh\nexport I_MPI_HYDRA_BOOTSTRAP_EXEC=/opt/pbs/bin/pbs_tmrsh\nexport I_MPI_DEVICE=rdssm\nexport I_MPI_FABRICS=ofa\n", "use_double_quotes": false, "filepath_executable": "/home/des01/zacarias/dorinitt/binVTST/vasp_std", "wrap_cmdline_params": false, "node_type": "data.core.code.installed.InstalledCode."}}, "potential_family": {"identifier": "workgraph.string", "value": null}, "potential_mapping": {"identifier": "workgraph.any", "value": null}, "parameters": {"identifier": "workgraph.any", "value": null}, "options": {"identifier": "workgraph.any", "value": null}, "kpoints_spacing": {"identifier": "workgraph.any", "value": null}, "clean_workdir": {"identifier": "workgraph.bool", "value": true}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "energies"}, {"name": "energies"}, {"name": "remote_folders"}], "position": [30, 30], "children": []}, "relax_slabs_scatter": {"identifier": "relax_slabs_scatter", "label": "relax_slabs_scatter", "node_type": "GRAPH", "inputs": [{"name": "slabs", "identifier": "workgraph.namespace"}, {"name": "code", "identifier": "workgraph.any"}, {"name": "potential_family", "identifier": "workgraph.string"}, {"name": "potential_mapping", "identifier": "workgraph.any"}, {"name": "parameters", "identifier": "workgraph.any"}, {"name": "options", "identifier": "workgraph.any"}, {"name": "slabs"}, {"name": "potential_family"}, {"name": "potential_mapping"}, {"name": "parameters"}, {"name": "options"}, {"name": "kpoints_spacing"}, {"name": "clean_workdir"}], "properties": {"code": {"identifier": "workgraph.any", "value": {"with_mpi": null, "append_text": "", "input_plugin": "vasp.vasp", "prepend_text": "module load intel/oneAPI/2022\nexport I_MPI_HYDRA_BOOTSTRAP=rsh\nexport I_MPI_HYDRA_BOOTSTRAP_EXEC=/opt/pbs/bin/pbs_tmrsh\nexport I_MPI_DEVICE=rdssm\nexport I_MPI_FABRICS=ofa\n", "use_double_quotes": false, "filepath_executable": "/home/des01/zacarias/dorinitt/binVTST/vasp_std", "wrap_cmdline_params": false, "node_type": "data.core.code.installed.InstalledCode."}}, "potential_family": {"identifier": "workgraph.string", "value": null}, "potential_mapping": {"identifier": "workgraph.any", "value": null}, "parameters": {"identifier": "workgraph.any", "value": null}, "options": {"identifier": "workgraph.any", "value": null}, "kpoints_spacing": {"identifier": "workgraph.any", "value": null}, "clean_workdir": {"identifier": "workgraph.bool", "value": true}, "restart_folders": {"identifier": "workgraph.dict", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "energies"}, {"name": "relaxed_structures"}, {"name": "energies"}, {"name": "relaxed_structures"}, {"name": "energies"}, {"name": "relaxed_structures"}, {"name": "energies"}, {"name": "remote_folders"}], "position": [30, 30], "children": []}, "calculate_relaxation_energies_scatter": {"identifier": "calculate_relaxation_energies_scatter", "label": "calculate_relaxation_energies_scatter", "node_type": "GRAPH", "inputs": [{"name": "unrelaxed_energies", "identifier": "workgraph.namespace"}, {"name": "relaxed_energies", "identifier": "workgraph.namespace"}, {"name": "unrelaxed_energies"}, {"name": "relaxed_energies"}], "properties": {"_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "relaxation_energies"}], "position": [30, 30], "children": []}, "identify_oxide_type": {"identifier": "identify_oxide_type", "label": "identify_oxide_type", "node_type": "CALCFUNCTION", "inputs": [{"name": "bulk_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "bulk_structure"}], "properties": {"bulk_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "result"}], "position": [30, 30], "children": []}, "compute_surface_energies_scatter": {"identifier": "compute_surface_energies_scatter", "label": "compute_surface_energies_scatter", "node_type": "GRAPH", "inputs": [{"name": "slabs", "identifier": "workgraph.namespace"}, {"name": "energies", "identifier": "workgraph.namespace"}, {"name": "bulk_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "bulk_energy", "identifier": "workgraph.float"}, {"name": "reference_energies", "identifier": "workgraph.dict"}, {"name": "formation_enthalpy", "identifier": "workgraph.dict"}, {"name": "oxide_type", "identifier": "workgraph.string"}, {"name": "slabs"}, {"name": "energies"}, {"name": "bulk_structure"}, {"name": "bulk_energy"}, {"name": "reference_energies"}, {"name": "formation_enthalpy"}, {"name": "oxide_type"}, {"name": "sampling"}], "properties": {"bulk_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "bulk_energy": {"identifier": "workgraph.float", "value": null}, "reference_energies": {"identifier": "workgraph.dict", "value": null}, "formation_enthalpy": {"identifier": "workgraph.dict", "value": null}, "oxide_type": {"identifier": "workgraph.string", "value": null}, "sampling": {"identifier": "workgraph.int", "value": 100}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "surface_energies"}], "position": [30, 30], "children": []}, "compute_cleavage_energies_scatter": {"identifier": "compute_cleavage_energies_scatter", "label": "compute_cleavage_energies_scatter", "node_type": "GRAPH", "inputs": [{"name": "slabs", "identifier": "workgraph.namespace"}, {"name": "energies", "identifier": "workgraph.namespace"}, {"name": "bulk_structure", "identifier": "workgraph.aiida_structuredata"}, {"name": "bulk_energy", "identifier": "workgraph.float"}, {"name": "slabs"}, {"name": "energies"}, {"name": "bulk_structure"}, {"name": "bulk_energy"}], "properties": {"bulk_structure": {"identifier": "workgraph.aiida_structuredata", "value": null}, "bulk_energy": {"identifier": "workgraph.float", "value": null}, "_wait": {"identifier": "workgraph.any", "value": null}}, "outputs": [{"name": "cleavage_energies"}], "position": [30, 30], "children": []}}, "links": [{"from_socket": "bulk_options", "from_node": "graph_inputs", "to_socket": "options", "to_node": "VaspWorkChain"}, {"from_socket": "kpoints_spacing", "from_node": "graph_inputs", "to_socket": "kpoints_spacing", "to_node": "VaspWorkChain"}, {"from_socket": "potential_family", "from_node": "graph_inputs", "to_socket": "potential_family", "to_node": "VaspWorkChain"}, {"from_socket": "bulk_potential_mapping", "from_node": "graph_inputs", "to_socket": "potential_mapping", "to_node": "VaspWorkChain"}, {"from_socket": "clean_workdir", "from_node": "graph_inputs", "to_socket": "clean_workdir", "to_node": "VaspWorkChain"}, {"from_socket": "misc", "from_node": "VaspWorkChain", "to_socket": "energies", "to_node": "extract_total_energy"}, {"from_socket": "metal_options", "from_node": "graph_inputs", "to_socket": "options", "to_node": "VaspWorkChain1"}, {"from_socket": "kpoints_spacing", "from_node": "graph_inputs", "to_socket": "kpoints_spacing", "to_node": "VaspWorkChain1"}, {"from_socket": "potential_family", "from_node": "graph_inputs", "to_socket": "potential_family", "to_node": "VaspWorkChain1"}, {"from_socket": "metal_potential_mapping", "from_node": "graph_inputs", "to_socket": "potential_mapping", "to_node": "VaspWorkChain1"}, {"from_socket": "clean_workdir", "from_node": "graph_inputs", "to_socket": "clean_workdir", "to_node": "VaspWorkChain1"}, {"from_socket": "misc", "from_node": "VaspWorkChain1", "to_socket": "energies", "to_node": "extract_total_energy1"}, {"from_socket": "nonmetal_options", "from_node": "graph_inputs", "to_socket": "options", "to_node": "VaspWorkChain2"}, {"from_socket": "kpoints_spacing", "from_node": "graph_inputs", "to_socket": "kpoints_spacing", "to_node": "VaspWorkChain2"}, {"from_socket": "potential_family", "from_node": "graph_inputs", "to_socket": "potential_family", "to_node": "VaspWorkChain2"}, {"from_socket": "nonmetal_potential_mapping", "from_node": "graph_inputs", "to_socket": "potential_mapping", "to_node": "VaspWorkChain2"}, {"from_socket": "clean_workdir", "from_node": "graph_inputs", "to_socket": "clean_workdir", "to_node": "VaspWorkChain2"}, {"from_socket": "misc", "from_node": "VaspWorkChain2", "to_socket": "energies", "to_node": "extract_total_energy2"}, {"from_socket": "oxygen_options", "from_node": "graph_inputs", "to_socket": "options", "to_node": "VaspWorkChain3"}, {"from_socket": "kpoints_spacing", "from_node": "graph_inputs", "to_socket": "kpoints_spacing", "to_node": "VaspWorkChain3"}, {"from_socket": "potential_family", "from_node": "graph_inputs", "to_socket": "potential_family", "to_node": "VaspWorkChain3"}, {"from_socket": "oxygen_potential_mapping", "from_node": "graph_inputs", "to_socket": "potential_mapping", "to_node": "VaspWorkChain3"}, {"from_socket": "clean_workdir", "from_node": "graph_inputs", "to_socket": "clean_workdir", "to_node": "VaspWorkChain3"}, {"from_socket": "misc", "from_node": "VaspWorkChain3", "to_socket": "energies", "to_node": "extract_total_energy3"}, {"from_socket": "structure", "from_node": "VaspWorkChain", "to_socket": "bulk_structure", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "result", "from_node": "extract_total_energy", "to_socket": "bulk_energy", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "structure", "from_node": "VaspWorkChain1", "to_socket": "metal_structure", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "result", "from_node": "extract_total_energy1", "to_socket": "metal_energy", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "structure", "from_node": "VaspWorkChain2", "to_socket": "nonmetal_structure", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "result", "from_node": "extract_total_energy2", "to_socket": "nonmetal_energy", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "structure", "from_node": "VaspWorkChain3", "to_socket": "oxygen_structure", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "result", "from_node": "extract_total_energy3", "to_socket": "oxygen_energy", "to_node": "calculate_formation_enthalpy"}, {"from_socket": "structure", "from_node": "VaspWorkChain", "to_socket": "bulk_structure", "to_node": "generate_slab_structures"}, {"from_socket": "slabs", "from_node": "generate_slab_structures", "to_socket": "slabs", "to_node": "scf_slabs_scatter"}, {"from_socket": "potential_family", "from_node": "graph_inputs", "to_socket": "potential_family", "to_node": "scf_slabs_scatter"}, {"from_socket": "bulk_potential_mapping", "from_node": "graph_inputs", "to_socket": "potential_mapping", "to_node": "scf_slabs_scatter"}, {"from_socket": "slab_parameters", "from_node": "graph_inputs", "to_socket": "parameters", "to_node": "scf_slabs_scatter"}, {"from_socket": "slab_options", "from_node": "graph_inputs", "to_socket": "options", "to_node": "scf_slabs_scatter"}, {"from_socket": "kpoints_spacing", "from_node": "graph_inputs", "to_socket": "kpoints_spacing", "to_node": "scf_slabs_scatter"}, {"from_socket": "clean_workdir", "from_node": "graph_inputs", "to_socket": "clean_workdir", "to_node": "scf_slabs_scatter"}, {"from_socket": "slabs", "from_node": "generate_slab_structures", "to_socket": "slabs", "to_node": "relax_slabs_scatter"}, {"from_socket": "potential_family", "from_node": "graph_inputs", "to_socket": "potential_family", "to_node": "relax_slabs_scatter"}, {"from_socket": "bulk_potential_mapping", "from_node": "graph_inputs", "to_socket": "potential_mapping", "to_node": "relax_slabs_scatter"}, {"from_socket": "slab_parameters", "from_node": "graph_inputs", "to_socket": "parameters", "to_node": "relax_slabs_scatter"}, {"from_socket": "slab_options", "from_node": "graph_inputs", "to_socket": "options", "to_node": "relax_slabs_scatter"}, {"from_socket": "kpoints_spacing", "from_node": "graph_inputs", "to_socket": "kpoints_spacing", "to_node": "relax_slabs_scatter"}, {"from_socket": "clean_workdir", "from_node": "graph_inputs", "to_socket": "clean_workdir", "to_node": "relax_slabs_scatter"}, {"from_socket": "energies", "from_node": "scf_slabs_scatter", "to_socket": "unrelaxed_energies", "to_node": "calculate_relaxation_energies_scatter"}, {"from_socket": "energies", "from_node": "relax_slabs_scatter", "to_socket": "relaxed_energies", "to_node": "calculate_relaxation_energies_scatter"}, {"from_socket": "structure", "from_node": "VaspWorkChain", "to_socket": "bulk_structure", "to_node": "identify_oxide_type"}, {"from_socket": "relaxed_structures", "from_node": "relax_slabs_scatter", "to_socket": "slabs", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "energies", "from_node": "relax_slabs_scatter", "to_socket": "energies", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "structure", "from_node": "VaspWorkChain", "to_socket": "bulk_structure", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "result", "from_node": "extract_total_energy", "to_socket": "bulk_energy", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "result", "from_node": "calculate_formation_enthalpy", "to_socket": "reference_energies", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "result", "from_node": "calculate_formation_enthalpy", "to_socket": "formation_enthalpy", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "result", "from_node": "identify_oxide_type", "to_socket": "oxide_type", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "thermodynamics_sampling", "from_node": "graph_inputs", "to_socket": "sampling", "to_node": "compute_surface_energies_scatter"}, {"from_socket": "relaxed_structures", "from_node": "relax_slabs_scatter", "to_socket": "slabs", "to_node": "compute_cleavage_energies_scatter"}, {"from_socket": "energies", "from_node": "relax_slabs_scatter", "to_socket": "energies", "to_node": "compute_cleavage_energies_scatter"}, {"from_socket": "structure", "from_node": "VaspWorkChain", "to_socket": "bulk_structure", "to_node": "compute_cleavage_energies_scatter"}, {"from_socket": "result", "from_node": "extract_total_energy", "to_socket": "bulk_energy", "to_node": "compute_cleavage_energies_scatter"}, {"from_socket": "result", "from_node": "extract_total_energy", "to_socket": "bulk_energy", "to_node": "graph_outputs"}, {"from_socket": "structure", "from_node": "VaspWorkChain", "to_socket": "bulk_structure", "to_node": "graph_outputs"}, {"from_socket": "result", "from_node": "extract_total_energy1", "to_socket": "metal_energy", "to_node": "graph_outputs"}, {"from_socket": "structure", "from_node": "VaspWorkChain1", "to_socket": "metal_structure", "to_node": "graph_outputs"}, {"from_socket": "result", "from_node": "extract_total_energy2", "to_socket": "nonmetal_energy", "to_node": "graph_outputs"}, {"from_socket": "structure", "from_node": "VaspWorkChain2", "to_socket": "nonmetal_structure", "to_node": "graph_outputs"}, {"from_socket": "result", "from_node": "extract_total_energy3", "to_socket": "oxygen_energy", "to_node": "graph_outputs"}, {"from_socket": "structure", "from_node": "VaspWorkChain3", "to_socket": "oxygen_structure", "to_node": "graph_outputs"}, {"from_socket": "result", "from_node": "calculate_formation_enthalpy", "to_socket": "formation_enthalpy", "to_node": "graph_outputs"}, {"from_socket": "slabs", "from_node": "generate_slab_structures", "to_socket": "slab_structures", "to_node": "graph_outputs"}, {"from_socket": "relaxed_structures", "from_node": "relax_slabs_scatter", "to_socket": "relaxed_slabs", "to_node": "graph_outputs"}, {"from_socket": "energies", "from_node": "relax_slabs_scatter", "to_socket": "slab_energies", "to_node": "graph_outputs"}, {"from_socket": "energies", "from_node": "scf_slabs_scatter", "to_socket": "unrelaxed_slab_energies", "to_node": "graph_outputs"}, {"from_socket": "relaxation_energies", "from_node": "calculate_relaxation_energies_scatter", "to_socket": "relaxation_energies", "to_node": "graph_outputs"}, {"from_socket": "surface_energies", "from_node": "compute_surface_energies_scatter", "to_socket": "surface_energies", "to_node": "graph_outputs"}, {"from_socket": "cleavage_energies", "from_node": "compute_cleavage_energies_scatter", "to_socket": "cleavage_energies", "to_node": "graph_outputs"}, {"from_socket": "remote_folders", "from_node": "relax_slabs_scatter", "to_socket": "slab_remote", "to_node": "graph_outputs"}, {"from_socket": "remote_folders", "from_node": "scf_slabs_scatter", "to_socket": "unrelaxed_slab_remote", "to_node": "graph_outputs"}]}

        // Define Schemes to use in vanilla JS
        const Schemes = {
            Node: ClassicPreset.Node,
            Connection: ClassicPreset.Connection
        };

        class Node extends ClassicPreset.Node {
          width = 180;
          height = 100;
        }
        class Connection extends ClassicPreset.Connection {}

        function createDynamicNode(nodeData) {
          const node = new Node(nodeData.label);
          // resize the node based on the max length of the input/output names
          let maxSocketNameLength = 0;
          nodeData.inputs.forEach((input) => {
            let socket = new ClassicPreset.Socket(input.name);
            if (!node.inputs.hasOwnProperty(input.name)) {
              node.addInput(input.name, new ClassicPreset.Input(socket, input.name));
              maxSocketNameLength = Math.max(maxSocketNameLength, input.name.length);
            }
          });

          nodeData.outputs.forEach((output) => {
            let socket = new ClassicPreset.Socket(output.name);
            if (!node.outputs.hasOwnProperty(output.name)) {
              node.addOutput(output.name, new ClassicPreset.Output(socket, output.name));
              maxSocketNameLength = Math.max(maxSocketNameLength, output.name.length);
            }
          });
          node.height = Math.max(140, node.height + (nodeData.inputs.length + nodeData.outputs.length) * 35)
          node.width += maxSocketNameLength * 5;

          return node;
        }


        async function addNode(editor, area, nodeData) {
          console.log("Adding node", nodeData);
          const node = createDynamicNode(nodeData);
          await editor.addNode(node);
          editor.nodeMap[nodeData.label] = node; // Assuming each nodeData has a unique ID
          await area.translate(node.id, { x: nodeData.position[0], y: nodeData.position[1] });
        }

        async function addLink(editor, area, layout, linkData) {
          const fromNode = editor.nodeMap[linkData.from_node];
          const toNode = editor.nodeMap[linkData.to_node];
          console.log("fromNode", fromNode, "toNode", toNode);
          let socket;
          if (fromNode && toNode) {
            socket = new ClassicPreset.Socket(linkData.from_socket);
            if (!fromNode.outputs.hasOwnProperty(linkData.from_socket)) {
              fromNode.addOutput(linkData.from_socket, new ClassicPreset.Output(socket, linkData.from_socket));
              fromNode.height += 25; // Increase height of node for each output
              area.update('node', fromNode.id);
            }
            socket = new ClassicPreset.Socket(linkData.to_socket);
            if (!toNode.inputs.hasOwnProperty(linkData.to_socket)) {
              toNode.addInput(linkData.to_socket, new ClassicPreset.Input(socket, linkData.to_socket));
              toNode.height += 25; // Increase height of node for each input
              area.update('node', toNode.id);
            }
            await editor.addConnection(new Connection(fromNode, linkData.from_socket, toNode, linkData.to_socket));
            // await layout(true);

          }
        }

        async function loadJSON(editor, area, layout, nodegraphData) {
          for (const nodeId in nodegraphData.nodes) {
            const nodeData = nodegraphData.nodes[nodeId];
            await addNode(editor, area, nodeData);
          }

          // Adding connections based on nodegraphData
          nodegraphData.links.forEach(async (link) => { // Specify the type of link here
            await addLink(editor, area, layout, link);
          });

          // Add while zones
          console.log("Adding while zone: ");
          for (const nodeId in nodegraphData.nodes) {
            const nodeData = nodegraphData.nodes[nodeId];
            const node_type = nodeData['node_type'];
            if (node_type === "WHILE" || node_type === "IF" || node_type === "ZONE" || node_type === "MAP") {
              // find the node
              const node = editor.nodeMap[nodeData.label];
              const children = nodeData['children'];
              // find the id of all nodes in the editor that has a label in while_zone
              for (const nodeId in children) {
                const node1 = editor.nodeMap[children[nodeId]];
                node1.parent = node.id;
              }
            }
          }
        }

        /**
        * Defines custom padding for a scope layout.
        * The padding values are used by the ScopesPlugin to avoid node overlapping with the socket of the parent node.
        */
        const customScopePadding = () => ({
          top: 80,
          left: 30,
          right: 30,
          bottom: 50
        });


        async function createEditor(container) {
            const socket = new ClassicPreset.Socket("socket");

            const editor = new NodeEditor(Schemes);
            const area = new AreaPlugin(container);
            const connection = new ConnectionPlugin();
            const render = new ReactPlugin({ createRoot });
            const scopes = new ScopesPlugin({padding: customScopePadding});
            const arrange = new AutoArrangePlugin();

            const minimap = new MinimapPlugin({
              boundViewport: true
            });

            AreaExtensions.selectableNodes(area, AreaExtensions.selector(), {
                accumulating: AreaExtensions.accumulateOnCtrl(),
            });

            render.addPreset(Presets.classic.setup());
            render.addPreset(Presets.minimap.setup({ size: 200 }));

            connection.addPreset(ConnectionPresets.classic.setup());
            scopes.addPreset(ScopesPresets.classic.setup());

            const applier = new ArrangeAppliers.TransitionApplier({
              duration: 500,
              timingFunction: (t) => t,
              async onTick() {
                await AreaExtensions.zoomAt(area, editor.getNodes());
              }
            });

            arrange.addPreset(ArrangePresets.classic.setup());


            editor.use(area);
            // area.use(connection);
            area.use(render);
            area.use(scopes);
            area.use(arrange);
            area.use(minimap);

            async function layout(animate) {
              await arrange.layout({ applier: animate ? applier : undefined });
              AreaExtensions.zoomAt(area, editor.getNodes());
            }

            // Adding nodes based on nodegraphData
            const nodeMap = {}; // To keep track of created nodes for linking
            editor.nodeMap = nodeMap;


            return {
              editor: editor,
              area: area,
              layout: layout,
              destroy: () => area.destroy()
            };
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }

        function App() {
            const [editor, setEditor] = useState(null);
            const containerRef = useRef(null);

            useEffect(() => {
                if (containerRef.current && !editor) {
                    createEditor(containerRef.current).then((editor) => {
                        setEditor(editor);
                        loadJSON(editor.editor, editor.area, editor.layout, nodegraphData).then(() => {
                          // aplly layout twice to ensure all nodes are arranged
                          editor?.layout(false).then(() => editor?.layout(true));
                        });
                        window.editor = editor;
                    });
                }
                if (document.getElementById('fullscreen-btn')) {
                    document.getElementById('fullscreen-btn').addEventListener('click', toggleFullScreen);
                }
                return () => {
                    if (editor) {
                        editor.destroy();
                    }
                };
            }, [containerRef, editor]);

            return (

                <div className="App">
                    <div>
                      <button onClick={() => editor?.layout(true)}>Arrange</button>
                      <button id="fullscreen-btn">Fullscreen</button>
                    </div>
                    <div ref={containerRef} className="rete" style={{ height: "100vh", width: "100%" }}></div>
                </div>
            );
        }

        const rootElement = document.getElementById("root");
        const root = createRoot(rootElement);

        root.render(
                <App />
        );
    </script>
</body>
</html>
