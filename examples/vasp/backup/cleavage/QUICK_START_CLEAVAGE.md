# Quick Start: Cleavage Energy Calculations

## What was implemented

A new module `teros.core.cleavage` that calculates cleavage energies for complementary slab pairs generated by pymatgen's SlabGenerator.

**Formula**: `Ec(i,j) = 1/(2A) * (E_i^slab + E_j^slab - n*E_bulk)`

## Running the Example

```bash
# Activate environment
source ~/envs/psteros/bin/activate

# Make sure daemon is running
verdi daemon status

# Run the example (Ag2O with cleavage energy)
python /home/thiagotd/git/worktree/PS-TEROS/cleavage_energy/examples/cleavage/slabs_relax_ag2o_cleavage.py
```

## Key Points

### 1. Enable in Your Script

```python
wg = build_core_workgraph_with_map(
    # ... other parameters ...
    relax_slabs=True,          # ← Required (must relax slabs first)
    compute_cleavage=True,     # ← NEW: Enable cleavage calculation
)
```

### 2. Complementary Pairs (Pymatgen Convention)

- **4 terminations**: (0,3), (1,2)
- **5 terminations**: (0,4), (1,3), (2,2)
- **6 terminations**: (0,5), (1,4), (2,3)

### 3. Access Results

```python
from aiida import load_node

wg = load_node(PK)
cleavages = wg.outputs.cleavage_energies

# List pairs
print(list(cleavages.keys()))  # ['pair_0_3', 'pair_1_2', ...]

# Get cleavage energy for a pair
data = cleavages['pair_0_3'].get_dict()
ec = data['cleavage_energy_eV_A2']  # eV/Ų
print(f"Cleavage energy: {ec:.4f} eV/Ų")
```

## Output Data

Each pair provides:
- `cleavage_energy_eV_A2`: Energy in eV/Ų
- `cleavage_energy_J_m2`: Energy in J/m² (= eV/Ų × 16.0217663)
- `term_i`, `term_j`: Termination indices (e.g., 0, 3)
- `n_formula_units`: Number of formula units in combined slabs
- `area_A2`: Surface area in ų
- Energies and compositions of both slabs

## Works for Both Oxide Types

### Binary (e.g., Ag₂O)
- Automatically calculates formula units from stoichiometry
- Example: Ag₂O → 2 Ag + 1 O per formula unit

### Ternary (e.g., Ag₃PO₄)
- Also works automatically
- Example: Ag₃PO₄ → 3 Ag + 1 P + 4 O per formula unit

## When to Use

✓ When slabs are **auto-generated** (by `generate_slab_structures`)
✓ When you need to understand **surface stability**
✓ When comparing **different terminations**
✓ When studying **surface reconstruction energies**

✗ Not needed if slabs are **manually input** (the code checks for auto-generation)

## Files Modified/Created

### New Files:
1. `teros/core/cleavage.py` - Main cleavage energy module
2. `docs/cleavage_energy.md` - Detailed documentation
3. `CLEAVAGE_IMPLEMENTATION.md` - Implementation details

### Modified Files:
1. `teros/core/workgraph.py` - Added cleavage energy support
2. `teros/core/__init__.py` - Added cleavage exports
3. `examples/cleavage/slabs_relax_ag2o_cleavage.py` - Updated example

## Monitoring Your Workflow

```bash
# Check workflow status
verdi process show <PK>

# Check report
verdi process report <PK>

# List all processes
verdi process list -a -p1
```

## Troubleshooting

1. **"No cleavage_energies in outputs"**
   - Make sure `compute_cleavage=True` and `relax_slabs=True`

2. **"Stoichiometry mismatch"**
   - Check that complementary slabs have correct atomic composition
   - This should not happen with pymatgen-generated slabs

3. **Import errors**
   - Make sure daemon was restarted: `verdi daemon restart`

## Next Steps

After workflow completes:
1. Load the workflow: `wg = load_node(PK)`
2. Access cleavage energies: `cleavages = wg.outputs.cleavage_energies`
3. Compare values across different pairs
4. Analyze which terminations are most stable
5. Export data for plotting/analysis

## Documentation

- Full documentation: `docs/cleavage_energy.md`
- Implementation details: `CLEAVAGE_IMPLEMENTATION.md`
- Example usage: `examples/cleavage/slabs_relax_ag2o_cleavage.py`

## Reference

Based on Yang et al. formula for cleavage energy of symmetric surfaces.
